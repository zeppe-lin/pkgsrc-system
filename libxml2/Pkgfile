# Description: XML parsing library, version 2
# URL:         https://gitlab.gnome.org/GNOME/libxml2
# Depends on:  xz zlib

name=libxml2
version=2.15.1
release=1
source=https://download.gnome.org/sources/$name/${version%.*}/$name-$version.tar.xz

build() {
	# Prevent git-based version injection
	sed -i '20,23s/^/#/' $name-$version/meson.build

	# Build flags:
	# - debugging=disabled: omit debug shell and module
	# - docs=disabled: otherwise requires pkgsrc-xorg/libxslt
	# - legacy=enabled: maximize ABI compatibility
	meson setup build $name-$version \
		--prefix=/usr \
		--buildtype=plain \
		--wrap-mode=nodownload \
		-D b_lto=true \
		-D b_pie=true \
		-D debugging=disabled \
		-D docs=disabled \
		-D legacy=enabled \

	ninja -C build -j ${JOBS:-1} -v
	DESTDIR=$PKG ninja -C build install
}
