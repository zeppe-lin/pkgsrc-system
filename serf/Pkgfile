# Description: HTTP client library built upon the APR library
# URL:         https://serf.apache.org/
# Depends on:  apr-util

name=serf
version=1.3.10
release=2
source="https://archive.apache.org/dist/serf/serf-$version.tar.bz2
	libserf-1.3.9-cmake.patch
	openssl3-ERR_GET_FUNC.patch"

build() {
	patch -d serf-$version -p1 -i $SRC/libserf-1.3.9-cmake.patch
	patch -d serf-$version -p1 -i $SRC/openssl3-ERR_GET_FUNC.patch

	cmake -S serf-$version -B build -G Ninja        \
		-D CMAKE_INSTALL_PREFIX=/usr            \
		-D CMAKE_BUILD_TYPE=Release             \
		-D CMAKE_C_FLAGS_RELEASE="$CFLAGS"      \
		-D CMAKE_CXX_FLAGS_RELEASE="$CXXFLAGS"  \
		-D BROTLI=OFF                           \
		-D GSSAPI=OFF                           \
		-D SKIP_STATIC=ON                       \
		-D SKIP_TESTS=ON                        \
		-Wno-dev

	ninja -C build -j ${JOBS:-1} -v
	DESTDIR=$PKG ninja -C build install
}
