# Description: Provides a secure layer over a reliable transport layer
# URL:         https://gnutls.org/
# Depends on:  libidn2 nettle p11-kit zstd

name=gnutls
version=3.8.11
release=1
source=https://www.gnupg.org/ftp/gcrypt/$name/v${version%.*}/$name-$version.tar.xz

build() {
	mkdir build; cd build

	# --disable-doc and --enable-manpages are mutually broken.
	# We configure default (enabled) and remove unwanted docs in cleanup.
	../$name-$version/configure \
		--prefix=/usr \
		--disable-bash-tests \
		--disable-full-test-suite \
		--disable-nls \
		--disable-static \
		--disable-tests \
		--disable-valgrind-tests \
		--with-default-trust-store-pkcs11="pkcs11:" \
		--without-tpm \

	# ensure strict linking and optimization
	sed -i -e 's/ -shared / -Wl,-O1,--as-needed\0/g' libtool

	make V=1
	make DESTDIR=$PKG install

	# remove junk
	cd $PKG/usr/share; rm -r info doc
	rm $PKG/usr/lib/*.la
}
