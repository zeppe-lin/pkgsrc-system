# Description: Basic networking utilities
# URL:         https://github.com/iputils/iputils
# Depends on:  libcap libidn2

name=iputils
version=20250605
release=2
source=https://github.com/iputils/iputils/releases/download/$version/$name-$version.tar.xz

build() {
	meson setup build $name-$version  \
		--prefix=/usr             \
		--buildtype=plain         \
		-D b_lto=true             \
		-D b_pie=true             \
		-D BUILD_MANS=false       \
		-D USE_GETTEXT=false      \
		-D USE_CAP=true           \
		-D SKIP_TESTS=true        \

	ninja -C build -j ${JOBS:-1} -v
	#DESTDIR=$PKG ninja -C build install

	install -m 0755 -D build/ping/ping  $PKG/bin/ping
	install -m 0755 -D build/arping     $PKG/sbin/arping
	install -m 0755 -D build/tracepath  $PKG/usr/sbin/tracepath
	install -m 0755 -D build/clockdiff  $PKG/usr/sbin/clockdiff

	install -m 0644 -Dt $PKG/usr/share/man/man8 $SRC/$name-$version/doc/*.8

	# cap_net_admin is needed for ping -m even on ICMP datagram socket
	# (or cap_net_raw since Linux kernel 5.17).
	setcap cap_net_admin,cap_net_raw+p $PKG/bin/ping
}
