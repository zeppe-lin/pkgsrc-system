# Description: Remote filesystem in userspace using SSH
# URL:         https://github.com/libfuse/sshfs
# Depends on:  docutils fuse glib
# Optional:    docutils

name=sshfs-fuse
version=3.7.5
release=1
source="https://github.com/libfuse/sshfs/releases/download/sshfs-$version/sshfs-$version.tar.xz
	manpage.patch"

build() {
	# disable hardcoded tests
	sed -i "/^subdir('test')/d" sshfs-$version/meson.build

	# man page cleanup (1)
	patch -d sshfs-$version -Np0 -i $SRC/manpage.patch

	meson setup build sshfs-$version \
		--prefix=/usr \
		--buildtype=release \
		--wrap-mode=nodownload \
		-D b_lto=true \
		-D b_pie=true \

	ninja -C build -j ${JOBS:-1} -v
	DESTDIR=$PKG ninja -C build install

	# man page cleanup (2)
	sed -i 's/^\.SH Name$/\.SH NAME/' $PKG/usr/share/man/man1/sshfs.1
}
