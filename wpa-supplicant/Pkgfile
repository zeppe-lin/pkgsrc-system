# Description: User space IEEE 802.1X/WPA supplicant (wireless client)
# URL:         http://hostap.epitest.fi/wpa_supplicant
# Depends on:  libnl openssl readline

name=wpa-supplicant
version=2.11
release=3
source="https://w1.fi/releases/wpa_supplicant-$version.tar.gz

	manpages-fixes.patch
	809d9d8172db8e2a08ff639875f838b5b86d2641.patch
	015f6a5a0cd1c8b0d40441b9fd9e4c8658bc9493.patch
	0001-Enable-TLSv1.0-by-default.patch
	0002-Disable-Werror-for-eapol_test.patch
	0003-Allow-legacy-renegotiation-to-fix-PEAP-issues-with-s.patch
	0004-Tweak-D-Bus-systemd-service-activation-configuration.patch
	0005-Add-IgnoreOnIsolate-yes-to-keep-wpa-supplicant-runni.patch
	0006-Add-reload-support-to-the-systemd-unit-files.patch
	0007-nl80211-add-extra-ies-only-if-allowed-by-driver.patch

	wpa_supplicant.conf
	rc.wpa_supplicant"

build() {
	for f in $SRC/*.patch; do
		patch -d wpa_supplicant-$version -Np1 -i $f
	done

	cd wpa_supplicant-$version/wpa_supplicant

	# disable dbus
	sed -i '/^CONFIG_CTRL_IFACE_DBUS=/d'       defconfig
	sed -i '/^CONFIG_CTRL_IFACE_DBUS_INTRO=/d' defconfig
	sed -i '/^CONFIG_CTRL_IFACE_DBUS_NEW=/d'   defconfig

	cp defconfig .config
	cat >> .config <<EOF
CONFIG_READLINE=y
CONFIG_LIBNL32=y
CFLAGS+=-I/usr/include/libnl3
EOF

	make V=1 BINDIR=/usr/sbin LIBDIR=/usr/lib

	install -m 0755 -Dt $PKG/usr/sbin/ \
		wpa_cli wpa_passphrase wpa_supplicant

	install -m 0644 -Dt $PKG/usr/share/man/man5/ \
		doc/docbook/wpa_supplicant.conf.5

	install -m 0644 -Dt $PKG/usr/share/man/man8/ \
		doc/docbook/wpa_background.8  \
		doc/docbook/wpa_cli.8         \
		doc/docbook/wpa_passphrase.8  \
		doc/docbook/wpa_supplicant.8  \

	# config
	install -m 0600 -Dt $PKG/etc/ $SRC/wpa_supplicant.conf

	# rc script
	install -m 0755 -D $SRC/rc.wpa_supplicant $PKG/etc/rc.d/wpa_supplicant
}
